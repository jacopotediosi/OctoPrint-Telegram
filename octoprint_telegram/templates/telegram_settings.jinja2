<form class="form-horizontal" id="settings_plugin_telegram">
    <!-- HEADER (COMMON TO ALL TABS) -->
    <h3>
        Telegram plugin settings
        <small>Version: {{ plugin_telegram_plugin_version }}</small>
    </h3>
    <p>
        <strong>
            If you need help on setting up this plugin, please have a look at
            <a href="https://github.com/jacopotediosi/OctoPrint-Telegram/wiki"
               target="_blank">the wiki on GitHub</a>.
        </strong>
    </p>
    <div class="tabbable">
        <!-- TAB NAVIGATION BUTTONS -->
        <ul class="nav nav-tabs">
            <li class="active">
                <a href="#telegram-settings-tab-connection" data-toggle="tab">Connection</a>
            </li>
            <li>
                <a href="#telegram-settings-tab-settings" data-toggle="tab">General settings</a>
            </li>
            <li>
                <a href="#telegram-settings-tab-chats" data-toggle="tab">Chats</a>
            </li>
            <li>
                <a href="#telegram-settings-tab-messages" data-toggle="tab">Notification messages</a>
            </li>
        </ul>
        <!-- TAB CONTENT -->
        <div class="tab-content">
            <!-- TAB CONNECTION -->
            <div class="tab-pane active" id="telegram-settings-tab-connection">
                <legend>Bot connection</legend>
                <div class="control-group">
                    <label class="control-label">Connection status:</label>
                    <div class="controls">
                        <p style="margin-bottom:0px; padding-top:5px;">
                            <strong data-bind="text: connection_state_str"></strong>
                        </p>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Telegram bot token</label>
                    <div class="controls">
                        <div class="reveal-wrapper">
                            <input type="password"
                                   id="telegram-settings-token"
                                   class="reveal-input"
                                   data-bind="value: settings.settings.plugins.telegram.token" />
                            <button type="button"
                                    class="btn reveal-btn"
                                    data-toggle="reveal"
                                    data-target="#telegram-settings-token"
                                    title="Show">
                                <i class="fa fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Test token</label>
                    <div class="controls">
                        <button class="btn"
                                data-bind="click: function() { testToken($('#telegram-settings-token').val()) }, disable: isTestingToken()"
                                title="Test the token">
                            <i class="icon-key"></i> Test above token
                        </button>
                        <span class="help-block"
                              data-bind="if: token_state_str || isTestingToken()">
                            Token status is:
                            <strong id="telegram-settings-token-state"
                                    data-bind="text: token_state_str, visible: !isTestingToken()"></strong>
                            <strong class="text-warning" data-bind="if: isTestingToken">Testing the token, please wait...</strong>
                        </span>
                    </div>
                </div>
                <div class="alert alert-warning" style="margin-top: 30px;">
                    Remember to click <strong>Save</strong> to apply changes.
                </div>
            </div>
            <!-- TAB GENERAL SETTINGS -->
            <div class="tab-pane" id="telegram-settings-tab-settings">
                <legend>Notification settings</legend>
                <div class="control-group">
                    <label class="control-label">Send notification every</label>
                    <div class="controls">
                        <div class="input-append">
                            <input type="number"
                                   step="any"
                                   min="0.0"
                                   class="input-mini text-right"
                                   data-bind="value: settings.settings.plugins.telegram.notification_height" />
                            <span class="add-on">mm</span>
                        </div>
                        &nbsp;or&nbsp;
                        <div class="input-append">
                            <input type="number"
                                   step="1"
                                   min="0"
                                   class="input-mini text-right"
                                   data-bind="value: settings.settings.plugins.telegram.notification_time" />
                            <span class="add-on">min</span>
                        </div>
                        <span class="help-block">
                            <small>
                                Sends a message when either the layer height has increased by this value or this many minutes have passed since the last notification. Set to 0 to disable.
                            </small>
                        </span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Delay for finished prints notification</label>
                    <div class="controls">
                        <div class="input-append">
                            <input type="number"
                                   step="any"
                                   min="0.0"
                                   class="input-mini text-right"
                                   data-bind="value: settings.settings.plugins.telegram.message_at_print_done_delay" />
                            <span class="add-on">s</span>
                        </div>
                        <span class="help-block"><small>Wait this many seconds after a print finishes before sending a notification. Useful to allow the print head and bed to reach their final positions. Set to 0 to disable.</small></span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Enable emojis</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.send_icon" />
                            <span class="help-inline"><small>Check to enable emojis in notification messages and command responses.</small></span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Disable "I do not understand you" messages</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.no_mistake" />
                            <span class="help-inline"><small>Check to disable "I do not understand you" messages.</small></span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Message on a loop</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.ForceLoopMessage" />
                            <span class="help-inline"><small>Check to call the printing event on loop if we never get an event (like for SD printing).</small></span>
                        </label>
                    </div>
                </div>
                <legend style="display: flex;
                               justify-content: space-between;
                               align-items: center">
                    Gifs generation
                    <div style="display: flex; gap: 8px;">
                        <!-- FFMPEG Badge -->
                        <span class="badge"
                              data-bind="text: requirements().ffmpeg_path ? 'ffmpeg: installed' : 'ffmpeg: not installed', css: requirements().ffmpeg_path ? 'badge-success' : 'badge-important', attr: { title: requirements().ffmpeg_path ? 'ffmpeg correctly installed: ' + requirements().ffmpeg_path : 'ffmpeg not installed. Try installing it with sudo apt install ffmpeg.' }"
                              style="cursor: default"></span>
                        <!-- CPULIMIT / LIMITCPU Badge -->
                        <span class="badge"
                              data-bind=" text: settings.settings.plugins.telegram.no_cpulimit() ? 'cpulimit / limitcpu: bypassed' : (requirements().cpulimiter_path ? 'cpulimit / limitcpu: installed' : 'cpulimit / limitcpu: not installed'), css: (requirements().cpulimiter_path || settings.settings.plugins.telegram.no_cpulimit()) ? 'badge-success' : 'badge-important', attr: { title: settings.settings.plugins.telegram.no_cpulimit() ? 'Bypassed via \'Don\'t use cpulimit/limitcpu checkbox\'' : (requirements().cpulimiter_path ? 'cpulimit / limitcpu correctly installed: ' + requirements().cpulimiter_path : 'cpulimit / limitcpu not installed. Try installing it with sudo apt install cpulimit or sudo apt install limitcpu.') }"
                              style="cursor: default"></span>
                        <!-- Reload icon (shown only if one is missing) -->
                        <button class="btn btn-mini"
                                title="Check again requirements"
                                data-bind="visible: !requirements().ffmpeg_path || (!requirements().cpulimiter_path && !settings.settings.plugins.telegram.no_cpulimit()), click: requestRequirements">
                            <i class="icon-refresh"></i>
                        </button>
                    </div>
                </legend>
                <div class="control-group">
                    <label class="control-label">Enable gifs</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.send_gif, enable: requirements().ffmpeg_path && (requirements().cpulimiter_path || settings.settings.plugins.telegram.no_cpulimit), attr: { title: (!requirements().ffmpeg_path || (!settings.settings.plugins.telegram.no_cpulimit() && !requirements().cpulimiter_path)) ? 'Required tools (ffmpeg and cpulimit / limitcpu) not installed' : '' }" />
                            <span class="help-inline">
                                <small>
                                    Check to enable gifs generation.
                                    <span class="text-warning">
                                        Warning, enabling this feature might affect your prints and make octoprint unresponsive: use at your own risk.
                                    </span>
                                </small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Don't use cpulimit/limitcpu</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.no_cpulimit" />
                            <span class="help-inline">
                                <small>
                                    Check to disable cpulimit/limitcpu, e.g., if you can't install them on your device.
                                    <span class="text-warning">
                                        Make sure your device is powerful enough (e.g., a Windows laptop).
                                        On embedded devices (e.g., a Raspberry Pi), you really should install cpulimit/limitcpu.
                                    </span>
                                </small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">FFmpeg preset</label>
                    <div class="controls">
                        <select class="input-block-level"
                                data-bind="value: settings.settings.plugins.telegram.ffmpeg_preset">
                            <option value="ultrafast">ultrafast</option>
                            <option value="superfast">superfast</option>
                            <option value="veryfast">veryfast</option>
                            <option value="faster">faster</option>
                            <option value="fast">fast</option>
                            <option value="medium" selected>medium</option>
                            <option value="slow">slow</option>
                            <option value="slower">slower</option>
                            <option value="veryslow">veryslow</option>
                        </select>
                        <span class="help-block">
                            <small>
                                Controls encoding speed vs file size.
                                Faster presets reduce processing time without quality loss but create larger files.
                                Slower presets produce smaller files but take longer to encode. See
                                <a href="https://trac.ffmpeg.org/wiki/Encode/H.264#Preset"
                                   target="_blank">FFmpeg documentation</a> for details.
                            </small>
                        </span>
                    </div>
                </div>
                <legend>Pre / post image actions</legend>
                <h5>Pre-image</h5>
                <div class="control-group">
                    <label class="control-label">Method</label>
                    <div class="controls">
                        <select class="input-block-level"
                                data-bind="value: settings.settings.plugins.telegram.PreImgMethod">
                            <option value="None">No Action</option>
                            <option value="EVENT">Trigger OctoPrint event (plugin_telegram_preimg)</option>
                            <option value="GCODE">G-Code Command</option>
                            <option value="SYSTEM">System Command</option>
                        </select>
                    </div>
                </div>
                <div class="control-group"
                     data-bind="visible: ['GCODE', 'SYSTEM'].includes(settings.settings.plugins.telegram.PreImgMethod())">
                    <label class="control-label">Command</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.PreImgCommand" />
                        <span class="help-block">
                            <small>For system commands, always use absolute paths when referencing files or scripts.</small>
                        </span>
                    </div>
                </div>
                <div class="control-group"
                     data-bind="visible: settings.settings.plugins.telegram.PreImgMethod() !== 'None'">
                    <label class="control-label">Delay</label>
                    <div class="controls">
                        <div class="input-append input-block-level">
                            <input type="number"
                                   step="1"
                                   min="0"
                                   data-bind="value: settings.settings.plugins.telegram.PreImgDelay" />
                            <span class="add-on">s</span>
                        </div>
                        <span class="help-block">
                            <small>
                                Delay (in seconds) between the execution of the pre-image action and the image capture - useful, for instance, to allow LEDs to power on completely.
                            </small>
                        </span>
                    </div>
                </div>
                <h5>Post-image</h5>
                <div class="control-group">
                    <label class="control-label">Method</label>
                    <div class="controls">
                        <select class="input-block-level"
                                data-bind="value: settings.settings.plugins.telegram.PostImgMethod">
                            <option value="None">No Action</option>
                            <option value="EVENT">Trigger OctoPrint event (plugin_telegram_postimg)</option>
                            <option value="GCODE">G-Code Command</option>
                            <option value="SYSTEM">System Command</option>
                        </select>
                    </div>
                </div>
                <div class="control-group"
                     data-bind="visible: ['GCODE', 'SYSTEM'].includes(settings.settings.plugins.telegram.PostImgMethod())">
                    <label class="control-label">Command</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.PostImgCommand" />
                        <span class="help-block">
                            <small>For system commands, always use absolute paths when referencing files or scripts.</small>
                        </span>
                    </div>
                </div>
                <div class="control-group"
                     data-bind="visible: settings.settings.plugins.telegram.PostImgMethod() !== 'None'">
                    <label class="control-label">Delay</label>
                    <div class="controls">
                        <div class="input-append input-block-level">
                            <input type="number"
                                   step="1"
                                   min="0"
                                   data-bind="value: settings.settings.plugins.telegram.PostImgDelay" />
                            <span class="add-on">s</span>
                        </div>
                        <span class="help-block">
                            <small>Delay (in seconds) between the image capture and the execution of the post-image action.</small>
                        </span>
                    </div>
                </div>
                <legend>ImgBB</legend>
                <div class="control-group">
                    <label class="control-label">API key ImgBB</label>
                    <div class="controls">
                        <div class="reveal-wrapper">
                            <input type="password"
                                   id="telegram-settings-imgbbapikey"
                                   class="reveal-input"
                                   data-bind="value: settings.settings.plugins.telegram.imgbbApiKey" />
                            <button type="button"
                                    class="btn reveal-btn"
                                    data-toggle="reveal"
                                    data-target="#telegram-settings-imgbbapikey"
                                    title="Show">
                                <i class="fa fa-eye"></i>
                            </button>
                        </div>
                        <span class="help-block">
                            <small>
                                The ImgBB API key is required to display thumbnails while browsing files on Telegram.
                                If you provide it, previews of your G-code files will be uploaded to ImgBB.
                                It is recommended to set your ImgBB account to private and enable automatic deletion of files after 5 minutes.
                                Refer to the <a href="https://imgbb.com/privacy">ImgBB Privacy Policy</a> for more information.
                            </small>
                        </span>
                    </div>
                </div>
                <legend style="display: flex;
                               justify-content: space-between;
                               align-items: center">
                    Proxies (for Telegram connection)
                    <button title="Click to open information dialog"
                            class="btn btn-info btn-small"
                            data-bind="click: function() {$root.proxyInfoDialog.modal('show');}">
                        <i class="icon-info-sign"></i> Proxy formats
                    </button>
                </legend>
                <div class="control-group">
                    <label class="control-label">Proxy HTTP</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.http_proxy" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Proxy HTTPS</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.https_proxy" />
                    </div>
                </div>
                <legend style="display: flex;
                               justify-content: space-between;
                               align-items: center">
                    Time formats
                    <button title="Click to open information dialog"
                            class="btn btn-info btn-small"
                            data-bind="click: function() {$root.timeInfoDialog.modal('show');}">
                        <i class="icon-info-sign"></i> Time formats
                    </button>
                </legend>
                <div class="control-group">
                    <label class="control-label">Time Format</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.TimeFormat" />
                        <span class="help-block"><small>Time format for finishing within the day.</small></span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Day Time Format</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.DayTimeFormat" />
                        <span class="help-block"><small>Time format for finishing within the week.</small></span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Week Time Format</label>
                    <div class="controls">
                        <input type="text"
                               class="input-block-level"
                               data-bind="value: settings.settings.plugins.telegram.WeekTimeFormat" />
                        <span class="help-block"><small>Time format for more than one week.</small></span>
                    </div>
                </div>
                <legend>File stuff</legend>
                <div class="control-group">
                    <label class="control-label">Select file on upload</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.selectFileUpload" />
                            <span class="help-inline"><small>Check to select the file directly after upload.</small></span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Sort files by upload date</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox"
                                   data-bind="checked: settings.settings.plugins.telegram.fileOrder" />
                            <span class="help-inline">
                                <small>
                                    If enabled, files will be listed by upload time (newest first) when using the /files command in Telegram.
                                    Otherwise, they will be listed alphabetically by name.
                                    This setting can also be changed within the Telegram file dialog.
                                </small>
                            </span>
                        </label>
                    </div>
                </div>
                <legend>Suggested plugins</legend>
                <p>
                    <small>
                        OctoPrint-Telegram can optionally integrate with several OctoPrint plugins. Installing them is not required but unlocks additional features and improves the overall user experience.
                    </small>
                </p>
                {# djlint:off #}
                {% set suggested_plugins_tabs = [
                    {
                        "title": "Camera",
                        "subtitle": "Installing the following plugins extends webcam and timelapse capabilities.",
                        "plugins": [
                            {
                                "id": "multicam",
                                "name": "MultiCam",
                                "description": "Allows notification messages and command responses (e.g., <code>/photo</code>, <code>/gif</code>, <code>/supergif</code>) to include snapshots and videos from multiple webcams, combined into a single album."
                            },
                            {
                                "id": "octolapse",
                                "name": "Octolapse",
                                "description": "Alternative to the bundled Timelapse plugin, allows receiving advanced timelapse videos as attachments in notification messages for the <code>MovieDone</code> event."
                            }
                        ]
                    },
                    {
                        "title": "Materials",
                        "subtitle": "Installing the following plugins allows you to view and manage filament spools via the <code>/filament</code> command.",
                        "plugins": [
                            {
                                "id": "filamentmanager",
                                "name": "FilamentManager",
                                "description": ""
                            },
                            {
                                "id": "SpoolManager",
                                "name": "SpoolManager",
                                "description": ""
                            }
                        ]
                    },
                    {
                        "title": "Metadata",
                        "subtitle": "Installing the following plugins extracts and exposes additional print metadata, making it available in notification message template variables and in the enhanced <code>/files</code> command output.",
                        "plugins": [
                            {
                                "id": "cost",
                                "name": "Cost estimator",
                                "description": "Displays estimated print cost within file details."
                            },
                            {
                                "id": "DisplayLayerProgress",
                                "name": "DisplayLayerProgress",
                                "description": "Adds support for <code>{currentLayer}</code> and <code>{totalLayer}</code> variables in notification messages."
                            },
                                                        {
                                "id": "prusaslicerthumbnails",
                                "name": "Slicer Thumbnails",
                                "description": "Extracts embedded slicer thumbnails from G-code files and makes them available in start print notifications and file details."
                            }
                        ]
                    },
                    {
                        "title": "Power",
                        "subtitle": "Installing any of the following plugins enables control of all connected power devices (printers, lights, heaters, etc.) via the <code>/power</code> command.",
                        "plugins": [
                            {
                                "id": "domoticz",
                                "name": "Domoticz",
                                "description": ""
                            },
                            {
                                "id": "gpiocontrol",
                                "name": "GPIO Control",
                                "description": ""
                            },
                            {
                                "id": "ikea_tradfri",
                                "name": "Ikea Tradfri",
                                "description": ""
                            },
                            {
                                "id": "octohue",
                                "name": "OctoHue",
                                "description": ""
                            },
                            {
                                "id": "octolight",
                                "name": "OctoLight",
                                "description": ""
                            },
                            {
                                "id": "octolightHA",
                                "name": "OctoLight HA",
                                "description": ""
                            },
                            {
                                "id": "octorelay",
                                "name": "OctoRelay",
                                "description": ""
                            },
                            {
                                "id": "orvibos20",
                                "name": "OrviboS20",
                                "description": ""
                            },
                            {
                                "id": "psucontrol",
                                "name": "PSU Control",
                                "description": ""
                            },
                            {
                                "id": "tasmota",
                                "name": "Tasmota",
                                "description": ""
                            },
                            {
                                "id": "tasmota_mqtt",
                                "name": "TasmotaMQTT",
                                "description": ""
                            },
                            {
                                "id": "tplinksmartplug",
                                "name": "TPLinkSmartplug",
                                "description": ""
                            },
                            {
                                "id": "tuyasmartplug",
                                "name": "TuyaSmartplug",
                                "description": ""
                            },
                            {
                                "id": "usbrelaycontrol",
                                "name": "USB Relay Control",
                                "description": ""
                            },
                            {
                                "id": "wemoswitch",
                                "name": "WemoSwitch",
                                "description": ""
                            },
                            {
                                "id": "wled",
                                "name": "WLED Connection",
                                "description": ""
                            },
                            {
                                "id": "ws281x_led_status",
                                "name": "WS281x LED Status",
                                "description": ""
                            }
                        ]
                    }
                ] %}
                {# djlint:on #}
                <div class="tabbable">
                    <!-- SUGGESTED PLUGINS TAB NAVIGATION BUTTONS -->
                    <ul class="nav nav-tabs">
                        {% for tab in suggested_plugins_tabs %}
                            <li class="{% if loop.first %}active{% endif %}">
                                <a href="#telegram-settings-suggested-{{ loop.index }}"
                                   data-toggle="tab">{{ tab.title }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                    <!-- SUGGESTED PLUGINS TAB CONTENT -->
                    <div class="tab-content">
                        {% for tab in suggested_plugins_tabs %}
                            <div class="tab-pane {% if loop.first %}active{% endif %}"
                                 id="telegram-settings-suggested-{{ loop.index }}">
                                {% if tab.subtitle %}
                                    <p>
                                        <small>{{ tab.subtitle | safe }}</small>
                                    </p>
                                {% endif %}
                                <table class="table table-condensed" style="table-layout: auto; width: 100%">
                                    <tbody>
                                        {% for plugin in tab.plugins %}
                                            <tr>
                                                <td style="width: 1%; padding: 10px">
                                                    <a href="https://plugins.octoprint.org/plugins/{{ plugin.id }}/"
                                                       target="_blank">{{ plugin.name }}</a>
                                                </td>
                                                <td style="width: 1%; padding: 10px">
                                                    <span data-bind=" text: (requirements() && requirements()['{{ plugin.id }}']) ? (requirements()['{{ plugin.id }}'] === 'enabled' ? 'Enabled' : requirements()['{{ plugin.id }}'] === 'disabled' ? 'Disabled' : 'Not installed') : 'Unknown', css: (requirements() && requirements()['{{ plugin.id }}']) ? (requirements()['{{ plugin.id }}'] === 'enabled' ? 'badge badge-success' : requirements()['{{ plugin.id }}'] === 'disabled' ? 'badge badge-warning' : 'badge badge-important') : 'badge badge-secondary'"
                                                          class="badge"
                                                          style="min-width: 80%;
                                                                 text-align: center"></span>
                                                </td>
                                                <td style="padding: 10px">
                                                    <span class="help-inline"><small>{{ plugin.description | safe }}</small></span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <!-- TAB CHATS -->
            <div class="tab-pane" id="telegram-settings-tab-chats">
                <legend>Enrollment</legend>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <button type="button"
                            class="btn"
                            style="white-space: nowrap"
                            data-bind="click: toggleEnrollmentCountdown, text: enrollmentCountdownButtonText"></button>
                    <small>
                        Click the button on the left to enable or disable enrollment.
                        While the enrollment countdown is active, send a message to the bot (in a private chat or group)
                        to add the chat to the table below.
                    </small>
                </p>
                <legend>Known chats</legend>
                <div style="position:relative">
                    <div style="position:absolute;
                                left:0px;
                                top:0px;
                                z-index:1010;
                                padding:0px;
                                width:100%;
                                height:100%;
                                background-color:white"
                         data-bind="visible: isChatsTableLoading()">
                        <span style="position:absolute;
                                     left:50%;
                                     top:50%;
                                     z-index:1011"
                              class="icon-spinner icon-spin icon-large"
                              title="Loading..."></span>
                    </div>
                    <table class="table table-condensed table-hover table-striped">
                        <thead>
                            <tr>
                                <th class="settings_users_name" style="border-right:1px dashed #ddd">Chat</th>
                                <th class="settings_users_active"
                                    style="width:40px;
                                           border-right:1px dashed #ddd">Command</th>
                                <th class="settings_users_active"
                                    style="width:40px;
                                           border-right:1px dashed #ddd">Notify</th>
                                <th class="settings_users_actions" style="width:40px;">Action</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: chatListHelper.paginatedItems">
                            <tr>
                                <td class="settings_users_name" style="border-right:1px dashed #ddd">
                                    <div style="float:left;
                                                padding:0px 5px 0px 0px;
                                                margin:0px;
                                                position:relative">
                                        <img data-bind="attr: { src: image ? image : (type && ['group', 'supergroup'].includes(type.toLowerCase()) ? '/plugin/telegram/static/img/group.jpg' : '/plugin/telegram/static/img/default.jpg'), __type: type }"
                                             width="40px"
                                             height="40px"
                                             class="img-circle teleUsrPic"
                                             alt="Chat profile photo"
                                             title="Chat profile photo"
                                             onerror="this.src = (this.getAttribute('__type') && ['group','supergroup'].includes(this.getAttribute('__type').toLowerCase()) ? '/plugin/telegram/static/img/group.jpg' : '/plugin/telegram/static/img/default.jpg')">
                                    </div>
                                    <div>
                                        <i data-bind="css: {'icon-user': private, 'icon-group': !private}"></i>&nbsp;
                                        <span data-bind="text: title"></span>
                                        <span class="muted" data-bind="visible: true">
                                            <br>
                                            <small style="text-transform: uppercase;">
                                                ID: <span data-bind="text: id"></span> | <span data-bind="text: type">UNKNOWN</span>
                                            </small>
                                        </span>
                                    </div>
                                </td>
                                <td class="settings_users_active"
                                    style="width:40px;
                                           vertical-align: middle;
                                           border-right:1px dashed #ddd;
                                           text-align: center">
                                    <span>
                                        <a href="#"
                                           data-bind="visible: accept_commands , click: function() {$root.showEditCmdDialog($data,'commands');}"
                                           style="text-decoration:none"
                                           title="Edit command rights">
                                            <i class="icon-off icon-large"></i>
                                        </a>
                                        <span data-bind="visible: !accept_commands && !allow_users"><i class="icon-remove icon-large"></i></span>
                                        <span data-bind="visible: !accept_commands && allow_users"><i class="icon-off icon-large"></i></span>
                                    </span>
                                </td>
                                <td class="settings_users_admin"
                                    style="width:40px;
                                           vertical-align: middle;
                                           border-right:1px dashed #ddd;
                                           text-align: center">
                                    <span>
                                        <a href="#"
                                           data-bind="visible: send_notifications , click: function() {$root.showEditCmdDialog($data,'notifications');}"
                                           style="text-decoration:none"
                                           title="Edit notification settings">
                                            <i class="icon-comment icon-large"></i>
                                        </a>
                                        <span data-bind="visible: !send_notifications"><i class="icon-remove icon-large"></i></span>
                                    </span>
                                </td>
                                <td class="settings_users_actions"
                                    style="width:40px;
                                           vertical-align: middle;
                                           text-align: center">
                                    <span>
                                        <a href="#"
                                           class="icon-pencil icon-large"
                                           title="Update chat settings"
                                           data-bind="click: function() { $root.showEditChatDialog($data);}"></a>&nbsp;&nbsp;|&nbsp;
                                    </span>
                                    <a href="#"
                                       class="icon-trash icon-large"
                                       title="Delete chat"
                                       data-bind="click:  function() { $root.delChat($data);}"></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- TAB NOTIFICATION MESSAGES -->
            <div class="tab-pane" id="telegram-settings-tab-messages">
                <legend style="display: flex;
                               justify-content: space-between;
                               align-items: center">
                    Messages at...
                    <div class="btn-group">
                        <button class="btn btn-info btn-small"
                                data-bind="click: function() {$root.mupInfoDialog.modal('show');}">
                            <i class="icon-info-sign"></i> Markups
                        </button>
                        <button class="btn btn-info btn-small"
                                data-bind="click: function() {$root.varInfoDialog.modal('show');}">
                            <i class="icon-info-sign"></i> Variables
                        </button>
                        <button class="btn btn-info btn-small"
                                data-bind="click: function() {$root.emoInfoDialog.modal('show');}">
                            <i class="icon-info-sign"></i> Emojis
                        </button>
                    </div>
                </legend>
                <div id="telegram-settings-msg-list">
                    <!-- Message settings get listed here -->
                </div>
                <label style="display: block; font-weight: bold; margin-bottom: 6px;">"Not connected" status</label>
                <div style="display: flex;
                            justify-content: space-around;
                            margin-bottom: 10px">
                    <div class="switch-container">
                        <label class="switch-label"
                               style="display: inline-flex;
                                      align-items: center;
                                      gap: 8px;
                                      cursor: pointer">
                            <span>Send camera photos &#x1F4F7;</span>
                            <input type="checkbox"
                                   style="display:none"
                                   class="switch-input"
                                   data-bind="checked: settings.settings.plugins.telegram.image_not_connected" />
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                    <div class="switch-container">
                        <label class="switch-label"
                               style="display: inline-flex;
                                      align-items: center;
                                      gap: 8px;
                                      cursor: pointer"
                               data-bind="css: { 'disabled': !settings.settings.plugins.telegram.send_gif() }, attr: { title: !settings.settings.plugins.telegram.send_gif() ? 'Check \'Enable gifs\' setting to use this option' : null }">
                            <span>Send camera gifs &#x1F3A5;</span>
                            <input type="checkbox"
                                   style="display:none"
                                   class="switch-input"
                                   data-bind="checked: settings.settings.plugins.telegram.gif_not_connected, enable: settings.settings.plugins.telegram.send_gif" />
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<!-- DIALOGS -->
<!-- EDIT CHAT DIALOG -->
<div id="settings-telegramDialogEditChat"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <h4>
            <i class="icon-wrench icon-large" style="color:dimgray"></i> Edit chat: <span data-bind="text: currChatTitle"></span>
        </h4>
    </div>
    <div class="modal-body">
        <form class="form-horizontal">
            <span id="telegram-user-allowed-chkbox"></span>
            <div class="control-group">
                <div class="controls">
                    <label class="checkbox">
                        <span id="telegram-acccmd-chkbox"></span>
                    </label>
                </div>
            </div>
            <div class="control-group">
                <div class="controls">
                    <label class="checkbox">
                        <span id="telegram-notify-chkbox"></span>
                    </label>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-bind="click: updateChat">Close</button>
    </div>
</div>
<!-- EDIT COMMANDS / NOTIFICATIONS DIALOG -->
<div id="settings-telegramDialogEditCommands"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <h4>
            <i class="icon-wrench icon-large" style="color:dimgray"></i> <span data-bind="text: currChatTitle"></span>
        </h4>
    </div>
    <div class="modal-body">
        <form class="form-horizontal" style="width: 80%; margin: auto;">
            <div class="alert alert-warning" style="margin-top: 10px;">
                Remember to click <strong>Save</strong> after closing this dialog to apply changes.
            </div>
            <div style="display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px">
                <h4 id="telegram-cmddialog-control-label" style="margin: 0;"></h4>
                <div>
                    <button type="button" class="btn" id="telegram-cmddialog-enable-all">Enable all</button>
                    <button type="button" class="btn" id="telegram-cmddialog-disable-all">Disable all</button>
                </div>
            </div>
            <table class="table table-vcenter table-striped">
                <thead>
                    <tr>
                        <th style="width:10%; text-align: center;">Enabled</th>
                        <th id="telegram-cmddialog-key-header" style="width:30%;">Key</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="telegram-cmddialog-tbody">
                </tbody>
            </table>
        </form>
    </div>
</div>
<!-- VARIABLES DIALOG -->
<div id="settings-telegramDialogVarInfo"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <nobr>
            <h4>
                <i class="icon-info-sign icon-large" style="color:blue"></i> Variables
            </h4>
        </nobr>
    </div>
    <div class="modal-body">
        Use Variables by adding <code>{&lt;varName&gt;}</code> to your message text (e.g., <code>{bed_temp}</code>). Usable Variables are:
        {# djlint:off #}
        {% set variable_table = [
            {
                "var": "{file} {path}",
                "desc": "File name and full path of the file currently being printed. <small class='muted'>Only useful while printing.</small>"
            },
            {
                "var": "{status}",
                "desc": "The raw output of <a href='https://docs.octoprint.org/en/master/modules/printer.html#octoprint.printer.PrinterInterface.get_current_data'><code>get_current_data()</code></a> OctoPrint function. "
                    "It's a dictionary you can navigate like: <code>status[state][text]</code>. Print it in a notification to explore its structure."
            },
            {
                "var": "{z}",
                "desc": "The current z value."
            },
            {
                "var": "{percent}",
                "desc": "Current percentage of the print progress. <small class='muted'>Only useful for height change notifications.</small>"
            },
            {
                "var": "{time_done} {time_left} {time_finish}",
                "desc": "Elapsed / remaining / estimated finish time of the current print. <small class='muted'>Only useful for height change events.</small>"
            },
            {
                "var": "{temps}",
                "desc": "The raw output of <a href='https://docs.octoprint.org/en/master/modules/printer.html#octoprint.printer.PrinterInterface.get_current_temperatures'><code>get_current_temperatures()</code></a> OctoPrint function. "
                    "It's a dictionary you can navigate like: <code>temps[bed][actual]</code>. Print it in a notification to explore its structure."
            },
            {
                "var": "{bed_temp} {eX_temp}",
                "desc": "Current temperatures of the bed and extruder X (where X ranges from 1 to 5)."
            },
            {
                "var": "{bed_target} {eX_target}",
                "desc": "Target temperatures of the bed and extruder X (where X ranges from 1 to 5)."
            },
            {
                "var": "{currentLayer} {totalLayer}",
                "desc": "Current and total number of layers. <small class='muted'><a href='https://plugins.octoprint.org/plugins/DisplayLayerProgress/'>DisplayLayerProgress</a> plugin required.</small>"
            },
            {
                "var": "{owner} {user}",
                "desc": "The name of the user who started the print / the name of the user who performed the action that triggered the notification (e.g., paused or canceled the print)."
            },
            {
                "var": "{event}",
                "desc": "The name of the event which caused the notification."
            },
            {
                "var": "{error_msg}",
                "desc": "The error message string. <small class='muted'>Only useful for 'Error' event notifications.</small>"
            },
            {
                "var": "{UserNotif_Text}",
                "desc": "The text received via the serial message <code>echo:UserNotif TEXT</code>, which is triggered by printing a G-code like: <code>M118 E1 UserNotif TEXT</code>. "
                    "<small class='muted'>Only useful for 'UserNotif' event notifications.</small>"
            },
        ] %}
        {# djlint:on #}
        <table class="table table-condensed table-striped"
               style="table-layout: auto">
            <thead>
                <tr>
                    <th style="border-right:1px dashed #ddd">Variable</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for row in variable_table %}
                    <tr>
                        <td style="vertical-align: middle; border-right:1px dashed #ddd">{{ row.var | safe }}</td>
                        <td style="vertical-align: middle;">{{ row.desc | safe }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <b>Note:</b> On startup and a few moments after startup of OctoPrint the temperatures can't be retrieved from the printer and will be shown as '0.0'
    </div>
</div>
<!-- EMOJIS DIALOG -->
<div id="settings-telegramDialogEmoInfo"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <nobr>
            <h4>
                <i class="icon-info-sign icon-large" style="color:blue"></i> Emojis
            </h4>
        </nobr>
    </div>
    <div class="modal-body">
        <p>
            Add <code>{emo:&lt;emoName&gt}</code> to your message text to use emojis.
            The <code>emoName</code> has to be set according to the 'Description' column on
            <a href="https://www.unicode.org/emoji/charts/full-emoji-list.html"
               target="_blank">this website</a>.
            Please note that no emoji will be sent if 'Enable Emojis' setting is disabled.
        </p>
        <p>
            <b>Example:</b>
            <br>
            If you want to use {{ "loudly crying face" | telegram_emoji }} in your message, you have to type <code>{emo:loudly crying face}</code>.
        </p>
        <br>
        <p>
            <span style="font-size:1.25em;">There are a few additional shortcuts available:</span>
            <table class="table table-condensed table-striped"
                   style="table-layout: auto">
                <thead>
                    <tr>
                        <th style="border-right:1px dashed #ddd;text-align:center;">Emoji</th>
                        <th style="border-right:1px solid #ddd">emoName</th>
                        <th style="border-right:1px dashed #ddd;text-align:center;">Emoji</th>
                        <th>emoName</th>
                    </tr>
                </thead>
                <tbody>
                    {% set items = plugin_telegram_custom_emoji_map.items()|list %}
                    {% for i in range(0, items|length, 2) %}
                        <tr>
                            {% for j in [0, 1] %}
                                {% if i + j < items|length %}
                                    {% set key, _ = items[i + j] %}
                                    <td style="border-right:1px dashed #ddd; text-align:center;">{{ key | telegram_emoji }}</td>
                                    <td style="border-right:1px solid #ddd">{{ key }}</td>
                                {% else %}
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </p>
        <p>
            <span class="muted">
                <small>
                    Data for internal icon list taken from: <a href="https://github.com/muan/unicode-emoji-json" target="_blank">muan/unicode-emoji-json</a>.
                </small>
            </span>
        </p>
    </div>
</div>
<!-- MARKUPS DIALOG -->
<div id="settings-telegramDialogMupInfo"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <nobr>
            <h4>
                <i class="icon-info-sign icon-large" style="color:blue"></i> Markups
            </h4>
        </nobr>
    </div>
    <div class="modal-body">
        <p>
            You can use simple markup in messages. Markup for messages is activated by the markup options below the message text fields. You can choose using HTML markup or the markdown variants. The list below shows the different markups you can use.
        </p>
        {% set markdown_table = [
        {
        "md": "*bold*",
        "html": "&lt;b&gt;bold&lt;/b&gt;<br>&lt;strong&gt;bold&lt;/strong&gt;",
        "effect": "<strong>bold</strong>"
        },
        {
        "md": "_italic_",
        "html": "&lt;i&gt;italic&lt;/i&gt;<br>&lt;em&gt;italic&lt;/em&gt;",
        "effect": "<em>italic</em>"
        },
        {
        "md": "[text](url)",
        "html": '&lt;a href="url"&gt;text&lt;/a&gt;',
        "effect": '<a href="#">text</a>'
        },
        {
        "md": "`inline code`",
        "html": "&lt;code&gt;inline code&lt;/code&gt;",
        "effect": "txt <code>inline code</code> txt"
        },
        {
        "md": "```code block```",
        "html": "&lt;pre&gt;code block&lt;/pre&gt;",
        "effect": "txt <pre>code block</pre> txt"
        }
        ] %}
        <table class="table table-condensed table-striped"
               style="table-layout: auto">
            <thead>
                <tr>
                    <th style="border-right:1px dashed #ddd;text-align:center;">Markdown</th>
                    <th style="border-right:1px dashed #ddd;text-align:center;">HTML</th>
                    <th style="text-align:center">Effect</th>
                </tr>
            </thead>
            <tbody>
                {% for row in markdown_table %}
                    <tr>
                        <td style="vertical-align: middle;
                                   border-right:1px dashed #ddd;
                                   text-align:center">{{ row.md }}</td>
                        <td style="vertical-align: middle;
                                   border-right:1px dashed #ddd;
                                   text-align:center">{{ row.html | safe }}</td>
                        <td style="vertical-align: middle; text-align:center">{{ row.effect | safe }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <p>
            <span class="muted">
                <small>
                    See
                    <a href="https://core.telegram.org/bots/api#formatting-options"
                       target="_blank">Telegram Bot API Documentation</a> for more information.
                </small>
            </span>
        </p>
    </div>
</div>
<!-- TIME FORMATS DIALOG -->
<div id="settings-telegramDialogTimeInfo"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <nobr>
            <h4>
                <i class="icon-info-sign icon-large" style="color:blue"></i> Time formats
            </h4>
        </nobr>
    </div>
    <div class="modal-body">
        <p>
            You can set the time format in the options.
            {% set format_codes = [
            ("%a", "Weekday as locale’s abbreviated name.", "Mon"),
            ("%A", "Weekday as locale’s full name.", "Monday"),
            ("%d", "Day of the month as a zero-padded decimal number.", "30"),
            ("%-d", "Day of the month as a decimal number. (Platform specific)", "30"),
            ("%b", "Month as locale’s abbreviated name.", "Sep"),
            ("%B", "Month as locale’s full name.", "September"),
            ("%m", "Month as a zero-padded decimal number.", "09"),
            ("%-m", "Month as a decimal number. (Platform specific)", "9"),
            ("%y", "Year without century as a zero-padded decimal number.", "13"),
            ("%Y", "Year with century as a decimal number.", "2013"),
            ("%H", "Hour (24-hour clock) as a zero-padded decimal number.", "07"),
            ("%-H", "Hour (24-hour clock) as a decimal number. (Platform specific)", "7"),
            ("%I", "Hour (12-hour clock) as a zero-padded decimal number.", "07"),
            ("%-I", "Hour (12-hour clock) as a decimal number. (Platform specific)", "7"),
            ("%p", "Locale’s equivalent of either AM or PM.", "AM"),
            ("%M", "Minute as a zero-padded decimal number.", "06"),
            ("%-M", "Minute as a decimal number. (Platform specific)", "6"),
            ("%S", "Second as a zero-padded decimal number.", "05"),
            ("%-S", "Second as a decimal number. (Platform specific)", "5"),
            ("%f", "Microsecond as a decimal number, zero-padded on the left.", "000000"),
            ("%z", "UTC offset in the form +HHMM or -HHMM (empty string if the object is naive).", ""),
            ("%Z", "Time zone name (empty string if the object is naive).", ""),
            ("%j", "Day of the year as a zero-padded decimal number.", "273"),
            ("%-j", "Day of the year as a decimal number. (Platform specific)", "273"),
            ("%U", "Week number of the year (Sunday as the first day of the week) as a zero padded decimal number. All days in a new year preceding the first Sunday are considered to be in week 0.", "39"),
            ("%W", "Week number of the year (Monday as the first day of the week) as a decimal number. All days in a new year preceding the first Monday are considered to be in week 0.", "39"),
            ("%c", "Locale’s appropriate date and time representation.", "Mon Sep 30 07:06:05 2013"),
            ("%x", "Locale’s appropriate date representation.", "09/30/13"),
            ("%X", "Locale’s appropriate time representation.", "07:06:05")
            ] %}
            <table class="table table-condensed table-striped"
                   style="table-layout: auto">
                <thead>
                    <tr>
                        <th style="border-right:1px dashed #ddd;text-align:center;">Code</th>
                        <th style="border-right:1px dashed #ddd;text-align:center;">Meaning</th>
                        <th style="text-align:center">Example</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code, meaning, example in format_codes %}
                        <tr>
                            <td style="vertical-align: middle;
                                       border-right:1px dashed #ddd;
                                       text-align:center">{{ code }}</td>
                            <td style="vertical-align: middle;
                                       border-right:1px dashed #ddd;
                                       text-align:center">{{ meaning }}</td>
                            <td style="vertical-align: middle;">{{ example }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </p>
    </div>
</div>
<!-- PROXY FORMATS DIALOG -->
<div id="settings-telegramDialogProxyInfo"
     class="modal modal-full hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            <i class="fas fa-times"></i>
        </button>
        <nobr>
            <h4>
                <i class="icon-info-sign icon-large" style="color:blue"></i> Proxy formats
            </h4>
        </nobr>
    </div>
    <div class="modal-body">
        <p>
            Proxy format: <code>scheme://[user:password@]host:port</code>
            <br>
            <br>
            Examples:
            <br>
            <ul>
                <li>
                    <code>http://proxy.example.com:8080</code>
                </li>
                <li>
                    <code>socks5h://127.0.0.1:9050</code>
                </li>
            </ul>
            <br>
            Supported schemes: <code>http</code>, <code>https</code>, <code>socks4</code>, <code>socks5</code>, <code>socks5h</code>.
            <br>
            Use <code>socks5h</code> scheme to proxy also dns requests, and <code>socks5</code> for regular dns requests.
        </p>
    </div>
</div>
